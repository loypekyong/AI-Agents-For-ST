from dsrag.knowledge_base import KnowledgeBase
from dsrag.llm import OpenAIChatAPI
from dsrag.reranker import CohereReranker, NoReranker

from dsrag.database.vector.chroma_db import ChromaDB
from dsrag.document_parsing import extract_text_from_pdf

# import environment variables
from dotenv import load_dotenv
from openai import OpenAI
import os, json

load_dotenv()

llm = OpenAIChatAPI(model='gpt-4o-mini')
reranker = CohereReranker()
# reranker = NoReranker()

com_id = "CommAero"
uss_id = "USS"

com_kb = KnowledgeBase(com_id, reranker = reranker, vector_db=ChromaDB(com_id), storage_directory="~/AI-Agents-For-ST/storage")
uss_kb = KnowledgeBase(uss_id, reranker = reranker, vector_db=ChromaDB(uss_id), storage_directory="~/AI-Agents-For-ST/storage")

query = "Airbus 2021 revenue"
id = "General Airbus 2021"

documents = com_kb.query(query)
print(documents)
print(documents[0]["text"])
# print(com_kb.chunk_db.data.keys())
# print(uss_kb.chunk_db.data.keys())
# chunks = len(com_kb.chunk_db.data[id])
# print(chunks)
# for i in range(chunks):
#     print(com_kb.chunk_db.get_chunk_text(id, i))

# # print(uss_kb.chunk_db.get_chunk_text(id, 2))